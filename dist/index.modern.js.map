{"version":3,"file":"index.modern.js","sources":["../src/utils/schema.js","../src/parser/markdown-to-richtext.js","../src/utils/factory-markdown-parser.js"],"sourcesContent":["import { Schema } from 'prosemirror-model'\n\n/**\n * @type {Schema}\n */\nexport default new Schema({\n  nodes: {\n    doc: {\n      content: 'block+'\n    },\n\n    paragraph: {\n      content: 'inline*',\n      group: 'block',\n      parseDOM: [{ tag: 'p' }],\n      toDOM () { return ['p', 0] }\n    },\n\n    blockquote: {\n      content: 'block+',\n      group: 'block',\n      parseDOM: [{ tag: 'blockquote' }],\n      toDOM () { return ['blockquote', 0] }\n    },\n\n    horizontal_rule: {\n      group: 'block',\n      parseDOM: [{ tag: 'hr' }],\n      toDOM () { return ['div', ['hr']] }\n    },\n\n    heading: {\n      attrs: { level: { default: 1 } },\n      content: 'inline*',\n      group: 'block',\n      defining: true,\n      parseDOM: [{ tag: 'h1', attrs: { level: 1 } },\n        { tag: 'h2', attrs: { level: 2 } },\n        { tag: 'h3', attrs: { level: 3 } },\n        { tag: 'h4', attrs: { level: 4 } },\n        { tag: 'h5', attrs: { level: 5 } },\n        { tag: 'h6', attrs: { level: 6 } }],\n      toDOM (node) { return ['h' + node.attrs.level, 0] }\n    },\n\n    code_block: {\n      content: 'text*',\n      group: 'block',\n      code: true,\n      defining: true,\n      attrs: { params: { default: '' } },\n      parseDOM: [{\n        tag: 'pre',\n        preserveWhitespace: true,\n        getAttrs: node => (\n          { params: node.getAttribute('data-params') || '' }\n        )\n      }],\n      toDOM (node) { return ['pre', node.attrs.params ? { 'data-params': node.attrs.params } : {}, ['code', 0]] }\n    },\n\n    ordered_list: {\n      content: 'list_item+',\n      group: 'block',\n      attrs: { order: { default: 1 }, tight: { default: false } },\n      parseDOM: [{\n        tag: 'ol',\n        getAttrs (dom) {\n          return {\n            order: dom.hasAttribute('start') ? +dom.getAttribute('start') : 1,\n            tight: dom.hasAttribute('data-tight')\n          }\n        }\n      }],\n      toDOM (node) {\n        return ['ol', {\n          start: node.attrs.order === 1 ? null : node.attrs.order,\n          'data-tight': node.attrs.tight ? 'true' : null\n        }, 0]\n      }\n    },\n\n    bullet_list: {\n      content: 'list_item+',\n      group: 'block',\n      attrs: { tight: { default: false } },\n      parseDOM: [{ tag: 'ul', getAttrs: dom => ({ tight: dom.hasAttribute('data-tight') }) }],\n      toDOM (node) { return ['ul', { 'data-tight': node.attrs.tight ? 'true' : null }, 0] }\n    },\n\n    list_item: {\n      content: 'paragraph block*',\n      defining: true,\n      parseDOM: [{ tag: 'li' }],\n      toDOM () { return ['li', 0] }\n    },\n\n    text: {\n      group: 'inline',\n      toDOM (node) { return node.text }\n    },\n\n    image: {\n      inline: true,\n      attrs: {\n        src: {},\n        alt: { default: null },\n        title: { default: null }\n      },\n      group: 'inline',\n      draggable: true,\n      parseDOM: [{\n        tag: 'img[src]',\n        getAttrs (dom) {\n          return {\n            src: dom.getAttribute('src'),\n            title: dom.getAttribute('title'),\n            alt: dom.getAttribute('alt')\n          }\n        }\n      }],\n      toDOM (node) { return ['img', node.attrs] }\n    },\n\n    hard_break: {\n      inline: true,\n      group: 'inline',\n      selectable: false,\n      parseDOM: [{ tag: 'br' }],\n      toDOM () { return ['br'] }\n    }\n  },\n\n  marks: {\n    italic: {\n      parseDOM: [{ tag: 'i' }, { tag: 'em' },\n        { style: 'font-style', getAttrs: value => value === 'italic' && null }],\n      toDOM () { return ['em'] }\n    },\n\n    bold: {\n      parseDOM: [\n        { tag: 'b' },\n        { tag: 'strong' },\n        {\n          style: 'font-weight',\n          getAttrs: value => /^(bold(er)?|[5-9]\\d{2,})$/.test(value) && null\n        }\n      ],\n      toDOM () { return ['bold'] }\n    },\n\n    link: {\n      attrs: {\n        href: {},\n        title: { default: null }\n      },\n      inclusive: false,\n      parseDOM: [{\n        tag: 'a[href]',\n        getAttrs (dom) {\n          return {\n            href: dom.getAttribute('href'),\n            title: dom.getAttribute('title')\n          }\n        }\n      }],\n      toDOM (node) { return ['a', node.attrs] }\n    },\n\n    code: {\n      parseDOM: [{ tag: 'code' }],\n      toDOM () { return ['code'] }\n    }\n  }\n})\n","import factoryMarkdownParser from '../utils/factory-markdown-parser'\nimport defaultSchema from '../utils/schema'\n\n/**\n * @typedef {{type: 'doc', content: Array<Object>}} RichtextInstance\n *\n * @method markdownToRichtext\n * @param  {String} content            a markdown string\n * @return {RichtextInstance}\n */\nconst markdownToRichtext = (content) => {\n  const markdownParser = factoryMarkdownParser(defaultSchema)\n\n  return markdownParser.parse(content).toJSON()\n}\n\nexport default markdownToRichtext\n","import { MarkdownParser } from 'prosemirror-markdown'\nimport markdownit from 'markdown-it'\n\n/**\n * @method factoryMarkdownParser\n * @param  {ProsemirrorModelSchema} schema schema from prosemirror-model package\n * @return {MarkdownParser} an instance of MarkdownParser class\n */\nconst factoryMarkdownParser = (schema) => {\n  const tokens = {\n    blockquote: {\n      block: 'blockquote'\n    },\n    paragraph: {\n      block: 'paragraph'\n    },\n    list_item: {\n      block: 'list_item'\n    },\n    bullet_list: {\n      block: 'bullet_list'\n    },\n    ordered_list: {\n      block: 'ordered_list',\n      getAttrs: token => ({ order: +token.attrGet('order') || 1 })\n    },\n    heading: {\n      block: 'heading',\n      getAttrs: token => ({ level: +token.tag.slice(1) })\n    },\n    code_block: {\n      block: 'code_block'\n    },\n    fence: {\n      block: 'code_block',\n      getAttrs: token => ({ params: token.info || '' })\n    },\n    hr: {\n      node: 'horizontal_rule'\n    },\n    image: {\n      node: 'image',\n      getAttrs: token => ({\n        src: token.attrGet('src'),\n        title: token.attrGet('title') || null,\n        alt: (token.children[0] && token.children[0].content) || null\n      })\n    },\n    hardbreak: {\n      node: 'hard_break'\n    },\n    em: {\n      mark: 'italic'\n    },\n    strong: {\n      mark: 'bold'\n    },\n    link: {\n      mark: 'link',\n      getAttrs: token => ({\n        href: token.attrGet('href'),\n        title: token.attrGet('title') || null\n      })\n    },\n    code_inline: {\n      mark: 'code'\n    }\n  }\n\n  const tokenizer = markdownit('commonmark', {\n    html: false\n  })\n\n  return new MarkdownParser(schema, tokenizer, tokens)\n}\n\nexport default factoryMarkdownParser\n"],"names":["Schema","nodes","doc","content","paragraph","group","parseDOM","tag","toDOM","blockquote","horizontal_rule","heading","attrs","level","default","defining","node","code_block","code","params","preserveWhitespace","getAttrs","getAttribute","data-params","ordered_list","order","tight","dom","hasAttribute","start","data-tight","bullet_list","list_item","text","image","inline","src","alt","title","draggable","hard_break","selectable","marks","italic","style","value","bold","test","link","href","inclusive","markdownToRichtext","schema","tokenizer","markdownit","html","MarkdownParser","block","token","attrGet","slice","fence","info","hr","children","hardbreak","em","mark","strong","code_inline","factoryMarkdownParser","defaultSchema","parse","toJSON"],"mappings":"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"}